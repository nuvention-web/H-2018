{"version":3,"sources":["../../src/pages/cards/cards.module.ts","../../src/pages/cards/cards.ts"],"names":[],"mappings":"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","file":"10.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { IonicPageModule } from 'ionic-angular';\n\n\nimport { CardsPage } from './cards';\n\n@NgModule({\n  declarations: [\n    CardsPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CardsPage),\n    TranslateModule.forChild()\n  ],\n  exports: [\n    CardsPage\n  ]\n})\nexport class CardsPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cards/cards.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, ModalController, NavController } from 'ionic-angular';\nimport { Observable } from 'rxjs/Observable';\nimport { Item } from '../../models/item';\nimport { Items } from '../../providers/providers';\nimport { Reviews } from '../../providers/providers';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport {AllegensProvider} from '../../providers/allegens/allegens';\nimport { AngularFireDatabase, AngularFireAction } from 'angularfire2/database'; \nimport { TabsPage } from '../tabs/tabs';\nimport { Storage } from '@ionic/storage';\n\n\n\n@IonicPage({name: 'CardsPage',\nsegment: 'cards-list'\n})\n@Component({\n  selector: 'page-cards',\n  templateUrl: 'cards.html'\n})\nexport class CardsPage {\n \n\n  cardItems: Item[];\n  Cards: Item[];\n  currentItems: any = [];\n  menuTypes: any =[];\n  count: number = 0;\n  types: any = [];\n  counts: number[] =[0,0,0,0,0,0,0,0,0,0,0];\n  countsReal: number[] =[0,0,0,0,0,0,0,0,0,0,0];\n\n\n\n  constructor(public storage: Storage, private db: AngularFireDatabase, public allergies: AllegensProvider, private geolocation: Geolocation, public navCtrl: NavController, public items: Items, public reviews: Reviews, public modalCtrl: ModalController) {\n    this.cardItems = this.items.query();\n    \n    \n  }\n\n  \n    \n  \nionViewWillEnter() {\n\n  this.counts  =[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];\n  this.countsReal =[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];\n\n  this.cardItems = this.items.query();\n\n  for (let index = 0; index < this.cardItems.length - 1; index++) {\n    this.menuTypes[index] = this.getReviews('/' + this.cardItems[index].data );\n   \n    this.menuTypes[index].subscribe(types => {\n      this.types[index] = types as any;\n     \n      for (let i = 0; i < types.length; i++) {\n        for (let j = 0; j < types[i].children.length-1; j++) {\n\n        if(types[i].children[j].menuItem)\n        {\n          this.counts[index]++;\n        }\n\n        if(!(this.allergies.wheat && types[i].children[j].wheat == 'TRUE') && !(this.allergies.peanuts && types[i].children[j].peanuts == 'TRUE') \n        && !(this.allergies.treenuts && types[i].children[j].treenuts == 'TRUE') && !(this.allergies.soy && types[i].children[j].soy == 'TRUE')\n        && !(this.allergies.milk && types[i].children[j].milk == 'TRUE') && !(this.allergies.eggs && types[i].children[j].eggs == 'TRUE')\n        && !(this.allergies.shellfish && types[i].children[j].shellfish == 'TRUE') && !(this.allergies.fish && types[i].children[j].fish == 'TRUE'))\n        {\n          this.countsReal[index]++;\n        }\n        \n\n        \n        \n        }\n        \n       \n        \n      }\n      \n      \n     \n      this.cardItems[index].percent = ((this.countsReal[index] / this.counts[index]) * 100).toFixed(0);\n      console.log(this.cardItems[index].name +\":\" + this.cardItems[index].percent);\n      this.sortItems(this.allergies.lat, this.allergies.lng);\n\n      \n\n\n\n     this.Cards = this.cardItems.slice().sort(this.percents);\n      \n\n}\n\n\n);\n\n\n}\n\n\n\n}\n\n\n\n\n\npercents(a,b){\n\n\n\n    return b.percent - a.percent;\n     \n}\n\n\ngetReviews(listPath): Observable<any[]> {\n\n \n  return this.db.list(listPath).valueChanges();\n  \n\n}\n\n  \n  openItem(item: Item) {\n\n    if(item.fake == true)\n    {\n\n      this.navCtrl.push('FakePage', {\n        item: item,\n        id: item.name\n      });\n\n    }else{\n\n    \n    this.storage.set('name', item).then( any => \n    this.navCtrl.push('CardDetailPage', {\n      item: item,\n      id: item.name\n    }));\n  }\n    \n  }\n\n\n  getItems(ev) {\n    let val = ev.target.value;\n    if (!val || !val.trim()) {\n      this.currentItems = [];\n      return;\n    }\n    this.currentItems = this.items.query({\n      name: val\n    });\n  }\n\n  sortItems(one, two)\n  {\n\n  let usersLocation = {\n    lat:  one,\n    lng: two\n    }\n\n  \n  \n\n  this.cardItems.map((item) => {\n\n      let placeLocation = {\n          lat: item.lat,\n          lng: item.lng\n      };\n\n      item.distance  = this.getDistanceBetweenPoints(\n          usersLocation,\n          placeLocation,\n          'miles'\n      ).toFixed(2);\n\n  \n  });\n\n /* this.cardItems.sort((locationA, locationB) => {\n    return locationA.distance - locationB.distance;\n\n    */\n\n\n\n\n\n\n  }\n\n\n\n\n\n  getDistanceBetweenPoints(start, end, units){\n \n    let earthRadius = {\n        miles: 3958.8,\n        km: 6371\n    };\n\n    let R = earthRadius[units || 'miles'];\n    let lat1 = start.lat;\n    let lon1 = start.lng;\n    let lat2 = end.lat;\n    let lon2 = end.lng;\n\n    let dLat = this.toRad((lat2 - lat1));\n    let dLon = this.toRad((lon2 - lon1));\n    let a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(this.toRad(lat1)) * Math.cos(this.toRad(lat2)) *\n    Math.sin(dLon / 2) *\n    Math.sin(dLon / 2);\n    let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    let d = R * c;\n\n    return d;\n\n}\n\ntoRad(x){\n    return x * Math.PI / 180;\n}\n\n\n\n \n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cards/cards.ts"],"sourceRoot":""}